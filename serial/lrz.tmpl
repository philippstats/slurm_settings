#!/bin/bash
## Job Resource Interface Definition
##
## walltime [integer(1)]:     Walltime for this job, in seconds.
##                            Must be between 1 and 3600 * 24 * 2.
## memory   [integer(1)]:     Memory in megabytes for each cpu.
##                            Must be between 100 and 64000.
##
## Default resources can be set in your .BatchJobs.R by defining the variable
## 'default.resources' as a named list.
<%
d = setdiff(names(resources), c("walltime", "memory"))
if (length(d) > 0L)
  stopf("Illegal resources used: %s", collapse(d))

walltime = asInt(resources$walltime, lower = 1L)
memory = asInt(resources$memory, lower = 100L, upper = 2200L)

cmd = "Rscript"

-%>

## general settings

#SBATCH -J <%= job.name %>
## direct stream to our logfile (-o is stdout and error)
#SBATCH --output=<%= log.file %>
#SBATCH --error=<%= log.file %>
#SBATCH --clusters=serial
#SBATCH --get-user-env
#SBATCH --export=NONE
#SBATCH --mail-user=philipp.stats@gmail.com


## basic resources

#SBATCH --time=<%= ceiling(walltime / 60L)%>
#SBATCH --mem=<%= resources$memory %>

source /etc/profile

## Run R:
## we merge R output with stdout from SLURM, which gets then logged via --output option

source /etc/profile.d/modules.sh
module load R/3.2mkl

## cmd defined in line 22/24; rscript is placeholder for r file generated by BatchJobs
<%= cmd %> "<%= rscript %>" /dev/stdout